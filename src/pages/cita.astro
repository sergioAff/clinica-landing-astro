---
import Layout from '../layouts/Layout.astro';
import ButtonMain from '../components/ButtonMain.astro';
---

<Layout title="Solicitar Cita | Mente Sana - Clínica de Psicología">
  <main>
    <section class="w-full max-w-6xl mx-auto px-4 sm:px-6 py-12 sm:py-16 mt-20">
      <div class="text-center mb-12">
        <p class="text-primary-400 font-semibold tracking-widest text-sm mb-2 uppercase">Solicitar cita</p>
        <h1 class="text-4xl sm:text-5xl font-bold text-gray-100 mb-4">Reserva tu sesión</h1>
        <p class="text-base sm:text-lg text-gray-400 max-w-2xl mx-auto">Rellena el formulario y nos pondremos en contacto contigo para confirmar tu cita lo antes posible.</p>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-start">
        <!-- Formulario de cita -->
        <div class="bg-dark-300/30 rounded-xl p-6 sm:p-8 shadow-lg border border-dark-200/30 order-2 lg:order-1" data-scroll-animation="fade-up">
          <h2 class="text-2xl font-semibold text-gray-100 mb-6">Información de contacto</h2>
          
          <form class="space-y-6" id="appointmentForm">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div>
                <label for="firstName" class="block text-sm font-medium text-gray-400 mb-1.5">Nombre <span class="text-primary-500">*</span></label>
                <input 
                  type="text" 
                  id="firstName" 
                  name="firstName" 
                  required 
                  class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors"
                  placeholder="Tu nombre"
                />
              </div>
              
              <div>
                <label for="lastName" class="block text-sm font-medium text-gray-400 mb-1.5">Apellidos <span class="text-primary-500">*</span></label>
                <input 
                  type="text" 
                  id="lastName" 
                  name="lastName" 
                  required 
                  class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors"
                  placeholder="Tus apellidos"
                />
              </div>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div>
                <label for="email" class="block text-sm font-medium text-gray-400 mb-1.5">Email <span class="text-primary-500">*</span></label>
                <input 
                  type="email" 
                  id="email" 
                  name="email" 
                  required 
                  class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors"
                  placeholder="Tu email"
                />
              </div>
              
              <div>
                <label for="phone" class="block text-sm font-medium text-gray-400 mb-1.5">Teléfono <span class="text-primary-500">*</span></label>
                <input 
                  type="tel" 
                  id="phone" 
                  name="phone" 
                  required 
                  class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors"
                  placeholder="Tu teléfono"
                />
              </div>
            </div>
            
            <div>
              <label for="serviceType" class="block text-sm font-medium text-gray-400 mb-1.5">Tipo de servicio <span class="text-primary-500">*</span></label>
              <select 
                id="serviceType" 
                name="serviceType" 
                required 
                class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors"
              >
                <option value="" disabled selected>Selecciona un servicio</option>
                <option value="terapia-individual">Terapia individual</option>
                <option value="terapia-pareja">Terapia de pareja</option>
                <option value="terapia-familiar">Terapia familiar</option>
                <option value="terapia-infantil">Terapia infantil</option>
                <option value="terapia-adolescentes">Terapia para adolescentes</option>
                <option value="mindfulness">Mindfulness</option>
                <option value="evaluacion-psicologica">Evaluación psicológica</option>
                <option value="coaching">Coaching</option>
              </select>
            </div>
            
            <div>
              <label for="preferredDate" class="block text-sm font-medium text-gray-400 mb-1.5">Fecha preferida <span class="text-primary-500">*</span></label>
              <input 
                type="date" 
                id="preferredDate" 
                name="preferredDate" 
                required 
                class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors"
              />
            </div>
            
            <div>
              <label for="preferredTime" class="block text-sm font-medium text-gray-400 mb-1.5">Hora preferida <span class="text-primary-500">*</span></label>
              <select 
                id="preferredTime" 
                name="preferredTime" 
                required 
                class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors"
              >
                <option value="" disabled selected>Selecciona una hora</option>
                <option value="morning">Mañana (9:00 - 12:00)</option>
                <option value="noon">Mediodía (12:00 - 15:00)</option>
                <option value="afternoon">Tarde (15:00 - 18:00)</option>
                <option value="evening">Tarde-noche (18:00 - 20:00)</option>
              </select>
            </div>
            
            <div>
              <label for="message" class="block text-sm font-medium text-gray-400 mb-1.5">Mensaje (opcional)</label>
              <textarea 
                id="message" 
                name="message" 
                rows="4" 
                class="w-full bg-dark-400/50 border border-dark-200/30 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:border-transparent transition-colors resize-none"
                placeholder="Describe brevemente el motivo de tu consulta..."
              ></textarea>
            </div>
            
            <div>
              <label class="flex items-start">
                <input type="checkbox" name="terms" required class="form-checkbox mt-1 bg-dark-400/50 border-dark-200/30 text-primary-500 rounded focus:ring-primary-500/30">
                <span class="ml-2 text-sm text-gray-400">Acepto la <a href="/politica-privacidad" class="text-primary-400 hover:underline">política de privacidad</a> y el <a href="/politica-privacidad" class="text-primary-400 hover:underline">tratamiento de mis datos</a> <span class="text-primary-500">*</span></span>
              </label>
            </div>
            
            <div class="mt-2 mb-3">
              <p class="text-sm text-gray-400">Elige cómo prefieres solicitar tu cita:</p>
              <ul class="text-xs text-gray-500 mt-1 space-y-1">
                <li class="flex items-center">
                  <span class="inline-block w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                  <span><strong>Email:</strong> Te responderemos en 24-48 horas laborables.</span>
                </li>
                <li class="flex items-center">
                  <span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                  <span><strong>WhatsApp:</strong> Respuesta más rápida durante horario de atención.</span>
                </li>
              </ul>
            </div>
            
            <div class="pt-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
              <!-- Submit button for email -->
              <button 
                type="submit" 
                id="submitButton" 
                class="w-full flex justify-center items-center px-6 py-3 rounded-lg text-white font-medium bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-2 focus:ring-offset-gray-900"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                  <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                </svg>
                Solicitar por email
              </button>
              
              <!-- WhatsApp button -->
              <button 
                type="button" 
                id="whatsappButton" 
                class="w-full flex justify-center items-center px-6 py-3 rounded-lg text-white font-medium bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 shadow-lg shadow-green-500/20 hover:shadow-green-500/40 transition-all focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:ring-offset-2 focus:ring-offset-gray-900"
                aria-label="Solicitar cita por WhatsApp"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.29.173-1.414-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                </svg>
                Solicitar por WhatsApp
              </button>
            </div>
          </form>
          
          <!-- Mensaje de error de validación (inicialmente oculto) -->
          <div id="validationError" class="hidden mt-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm">
            Por favor, completa correctamente todos los campos requeridos.
          </div>
        </div>
        
        <!-- Información adicional -->
        <div class="space-y-8 order-1 lg:order-2">
          <div class="bg-dark-300/30 rounded-xl p-6 sm:p-8 shadow-lg border border-dark-200/30" data-scroll-animation="fade-up">
            <h2 class="text-2xl font-semibold text-gray-100 mb-4">¿Por qué elegir Mente Sana?</h2>
            
            <ul class="space-y-4 text-gray-400">
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-400 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                <div>
                  <h3 class="text-lg font-medium text-gray-200 mb-1">Profesionales cualificados</h3>
                  <p>Nuestro equipo está formado por psicólogos con amplia experiencia y formación especializada.</p>
                </div>
              </li>
              
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-400 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                  <h3 class="text-lg font-medium text-gray-200 mb-1">Horarios flexibles</h3>
                  <p>Ofrecemos citas en horario de mañana y tarde para adaptarnos a tu disponibilidad.</p>
                </div>
              </li>
              
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-400 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                </svg>
                <div>
                  <h3 class="text-lg font-medium text-gray-200 mb-1">Ambiente confortable</h3>
                  <p>Nuestras instalaciones están diseñadas para ofrecerte un espacio acogedor y tranquilo.</p>
                </div>
              </li>
              
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-400 mr-3 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
                <div>
                  <h3 class="text-lg font-medium text-gray-200 mb-1">Confidencialidad total</h3>
                  <p>Garantizamos la privacidad y confidencialidad de toda la información compartida.</p>
                </div>
              </li>
            </ul>
          </div>
          
          <div class="bg-dark-300/30 rounded-xl p-6 sm:p-8 shadow-lg border border-dark-200/30" data-scroll-animation="fade-up">
            <h2 class="text-2xl font-semibold text-gray-100 mb-4">Preguntas frecuentes</h2>
            
            <div class="space-y-4">
              <div>
                <h3 class="text-lg font-medium text-gray-200 mb-1">¿Cuánto dura una sesión?</h3>
                <p class="text-gray-400">Nuestras sesiones tienen una duración de 50-60 minutos, dependiendo del tipo de terapia.</p>
              </div>
              
              <div>
                <h3 class="text-lg font-medium text-gray-200 mb-1">¿Cuál es el coste de una sesión?</h3>
                <p class="text-gray-400">El precio estándar es de 70€ por sesión, con opciones de bonos para tratamientos continuados.</p>
              </div>
              
              <div>
                <h3 class="text-lg font-medium text-gray-200 mb-1">¿Ofrecéis terapia online?</h3>
                <p class="text-gray-400">Sí, disponemos de sesiones por videollamada con la misma calidad que las presenciales.</p>
              </div>
              
              <div>
                <h3 class="text-lg font-medium text-gray-200 mb-1">¿Cómo puedo cancelar una cita?</h3>
                <p class="text-gray-400">Puedes cancelar o reprogramar hasta 24 horas antes sin coste adicional.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('appointmentForm') as HTMLFormElement;
    const submitButton = document.getElementById('submitButton') as HTMLButtonElement;
    const whatsappButton = document.getElementById('whatsappButton') as HTMLButtonElement;
    const validationError = document.getElementById('validationError') as HTMLDivElement;
    
    // Configurar animaciones al scroll
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const animationType = entry.target.getAttribute('data-scroll-animation');
          if (animationType) {
            entry.target.classList.add(animationType, 'animated');
          }
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.15,
      rootMargin: '0px 0px -50px 0px'
    });
    
    // Observe all elements with data-scroll-animation
    document.querySelectorAll('[data-scroll-animation]').forEach(element => {
      observer.observe(element);
    });
    
    // Función para formatear fecha
    const formatDate = (dateString: string): string => {
      const options: Intl.DateTimeFormatOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
      return new Date(dateString).toLocaleDateString('es-ES', options);
    };
    
    // Traducir preferencia de horario
    const translateTimePreference = (value: string): string => {
      const translations: Record<string, string> = {
        'morning': 'Mañana (9:00 - 12:00)',
        'noon': 'Mediodía (12:00 - 15:00)',
        'afternoon': 'Tarde (15:00 - 18:00)',
        'evening': 'Tarde-noche (18:00 - 20:00)'
      };
      return translations[value] || value;
    };
    
    // Traducir tipo de servicio
    const translateService = (value: string): string => {
      const translations: Record<string, string> = {
        'terapia-individual': 'Terapia individual',
        'terapia-pareja': 'Terapia de pareja',
        'terapia-familiar': 'Terapia familiar',
        'terapia-infantil': 'Terapia infantil',
        'terapia-adolescentes': 'Terapia para adolescentes',
        'mindfulness': 'Mindfulness',
        'evaluacion-psicologica': 'Evaluación psicológica',
        'coaching': 'Coaching'
      };
      return translations[value] || value;
    };
    
    // Función para validar el formulario y mostrar errores
    const validateForm = () => {
      if (!form.checkValidity()) {
        form.reportValidity();
        validationError.classList.remove('hidden');
        // Ocultar el mensaje de error después de 5 segundos
        setTimeout(() => {
          validationError.classList.add('hidden');
        }, 5000);
        return false;
      }
      validationError.classList.add('hidden');
      return true;
    };
    
    // Manejar click en botón de WhatsApp
    if (whatsappButton && form) {
      whatsappButton.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Validar el formulario antes de continuar
        if (!validateForm()) {
          return;
        }
        
        // Recopilar datos del formulario
        const formData = new FormData(form);
        const firstName = formData.get('firstName') as string;
        const lastName = formData.get('lastName') as string;
        const phone = formData.get('phone') as string;
        const email = formData.get('email') as string;
        const serviceTypeValue = formData.get('serviceType') as string;
        const serviceType = translateService(serviceTypeValue);
        const preferredDateValue = formData.get('preferredDate') as string;
        const preferredDate = formatDate(preferredDateValue);
        const preferredTimeValue = formData.get('preferredTime') as string;
        const preferredTime = translateTimePreference(preferredTimeValue);
        const message = formData.get('message') as string;
        
        // Crear mensaje para WhatsApp
        let whatsappMessage = `Hola, soy ${firstName} ${lastName}. Me gustaría solicitar una cita.%0A%0A`;
        whatsappMessage += `*Datos de contacto:*%0A`;
        whatsappMessage += `- Nombre: ${firstName} ${lastName}%0A`;
        whatsappMessage += `- Teléfono: ${phone}%0A`;
        whatsappMessage += `- Email: ${email}%0A%0A`;
        whatsappMessage += `*Datos de la cita:*%0A`;
        whatsappMessage += `- Servicio: ${serviceType}%0A`;
        whatsappMessage += `- Fecha preferida: ${preferredDate}%0A`;
        whatsappMessage += `- Horario preferido: ${preferredTime}%0A`;
        
        if (message && message.trim() !== '') {
          whatsappMessage += `%0A*Mensaje adicional:*%0A${message}`;
        }
        
        // Número de WhatsApp de la clínica
        const whatsappNumber = '+598 98018044'; 
        
        // Abrir WhatsApp con el mensaje predefinido
        const whatsappUrl = `https://wa.me/${whatsappNumber.replace(/\D/g, '')}?text=${whatsappMessage}`;
        window.open(whatsappUrl, '_blank');
      });
    }
    
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Validar formulario
        if (!validateForm()) {
          return;
        }
        
        // Simular envío (aquí iría el código para enviar el formulario)
        let originalContent = '';
        try {
          if (submitButton) {
            // Cambiar estado del botón a "cargando"
            originalContent = submitButton.innerHTML;
            submitButton.innerHTML = '<svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Procesando...';
            submitButton.disabled = true;
            whatsappButton.disabled = true;
            
            // Simular tiempo de procesamiento
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Mostrar mensaje de éxito
            form.innerHTML = `
              <div class="bg-green-500/10 text-green-400 p-6 rounded-lg border border-green-500/20 text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                  <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                <h4 class="text-xl font-semibold mb-3">¡Solicitud enviada con éxito!</h4>
                <p class="mb-6">Hemos recibido tu solicitud de cita. Nos pondremos en contacto contigo lo antes posible para confirmar los detalles.</p>
                <button type="button" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors cursor-pointer" onclick="location.href='/'">
                  Volver al inicio
                </button>
              </div>
            `;
          }
        } catch (error) {
          console.error('Error al enviar el formulario:', error);
          validationError.textContent = 'Ha ocurrido un error al enviar el formulario. Por favor, inténtalo de nuevo más tarde.';
          validationError.classList.remove('hidden');
          
          if (submitButton) {
            submitButton.innerHTML = originalContent;
            submitButton.disabled = false;
            whatsappButton.disabled = false;
          }
        }
      });
    }
  });
</script>

<style>
  /* Efectos de animación */
  [data-scroll-animation] {
    opacity: 0;
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
  }

  [data-scroll-animation].animated {
    opacity: 1;
  }

  [data-scroll-animation="fade-up"] {
    transform: translateY(30px);
  }

  [data-scroll-animation="fade-up"].animated {
    transform: translateY(0);
  }
</style> 