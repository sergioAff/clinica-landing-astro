---
import Layout from '../../../layouts/Layout.astro';
import Container from '../../../components/Container.astro';
import ButtonSub from '../../../components/ButtonSub.astro';
import Header from '../../../components/Header/Header.astro';
import Footer from '../../../components/Footer/Footer.astro';
import LazyImage from '../../../components/LazyImage.astro';
import { ArrowLeft, ArrowRight } from 'lucide-astro';

// Obtener la categoría de la URL
export async function getStaticPaths() {
  // Esto sería reemplazado por datos reales de un CMS o base de datos
  const allArticles = [
    {
      id: 1,
      title: '5 técnicas efectivas para manejar la ansiedad en situaciones cotidianas',
      excerpt: 'Descubre estrategias prácticas y basadas en evidencia para gestionar los síntomas de ansiedad y recuperar el control en tu día a día.',
      category: 'Ansiedad',
      categoryColor: 'bg-blue-500',
      image: '/img/blog/article1.jpg',
      date: '15 Mayo, 2023',
      readTime: '5 min lectura',
      author: 'Dra. María Rodríguez',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/ansiedad-tecnicas',
      dateISO: '2023-05-15'
    },
    {
      id: 2,
      title: 'Etapas del desarrollo emocional en niños: guía para padres',
      excerpt: 'Comprende las diferentes fases del desarrollo emocional infantil y aprende cómo acompañar a tu hijo en cada etapa para promover su bienestar.',
      category: 'Infancia',
      categoryColor: 'bg-green-500',
      image: '/img/blog/article2.jpg',
      date: '2 Junio, 2023',
      readTime: '7 min lectura',
      author: 'Dr. Carlos Mendoza',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/desarrollo-emocional-infantil',
      dateISO: '2023-06-02'
    },
    {
      id: 3,
      title: 'Comunicación efectiva en pareja: claves para evitar conflictos',
      excerpt: 'Aprende a mejorar la comunicación con tu pareja mediante técnicas que fomentan la empatía, la escucha activa y la resolución constructiva de conflictos.',
      category: 'Relaciones',
      categoryColor: 'bg-red-500',
      image: '/img/blog/article3.jpg',
      date: '20 Mayo, 2023',
      readTime: '6 min lectura',
      author: 'Dra. Laura Sánchez',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/comunicacion-efectiva-pareja',
      dateISO: '2023-05-20'
    },
    {
      id: 4,
      title: 'La importancia del autocuidado en tiempos de estrés',
      excerpt: 'Descubre por qué el autocuidado es fundamental para mantener tu salud mental, especialmente en momentos de alta presión y estrés.',
      category: 'Bienestar',
      categoryColor: 'bg-purple-500',
      image: '/img/blog/article1.jpg',
      date: '10 Junio, 2023',
      readTime: '4 min lectura',
      author: 'Dr. Javier Martínez',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/autocuidado-tiempos-estres',
      dateISO: '2023-06-10'
    },
    {
      id: 5,
      title: 'Cómo superar una ruptura: guía psicológica para el duelo emocional',
      excerpt: 'Estrategias efectivas para procesar el dolor emocional tras una ruptura y reconstruir tu vida con fortaleza y nuevas perspectivas.',
      category: 'Duelo',
      categoryColor: 'bg-indigo-500',
      image: '/img/blog/article2.jpg',
      date: '5 Junio, 2023',
      readTime: '8 min lectura',
      author: 'Dra. Ana García',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/superar-ruptura-duelo-emocional',
      dateISO: '2023-06-05'
    },
    {
      id: 6,
      title: 'Mindfulness para principiantes: guía práctica para empezar',
      excerpt: 'Una introducción sencilla a la práctica del mindfulness, con ejercicios prácticos que puedes incorporar a tu rutina diaria para reducir el estrés.',
      category: 'Mindfulness',
      categoryColor: 'bg-teal-500',
      image: '/img/blog/article3.jpg',
      date: '1 Junio, 2023',
      readTime: '5 min lectura',
      author: 'Dr. Roberto Sánchez',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/mindfulness-principiantes',
      dateISO: '2023-06-01'
    },
    {
      id: 7,
      title: 'Trastornos del sueño: causas, síntomas y tratamientos',
      excerpt: 'Análisis de los principales trastornos del sueño, sus posibles causas psicológicas y las opciones de tratamiento más efectivas según la evidencia.',
      category: 'Sueño',
      categoryColor: 'bg-blue-400',
      image: '/img/blog/article1.jpg',
      date: '28 Mayo, 2023',
      readTime: '7 min lectura',
      author: 'Dra. Elena Torres',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/trastornos-sueno-tratamientos',
      dateISO: '2023-05-28'
    },
    {
      id: 8,
      title: 'El síndrome del impostor: cómo identificarlo y superarlo',
      excerpt: 'Aprende a reconocer este fenómeno psicológico común y estrategias efectivas para gestionarlo y recuperar la confianza en tus capacidades.',
      category: 'Autoestima',
      categoryColor: 'bg-yellow-500',
      image: '/img/blog/article2.jpg',
      date: '25 Mayo, 2023',
      readTime: '6 min lectura',
      author: 'Dr. Miguel López',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/sindrome-impostor',
      dateISO: '2023-05-25'
    },
    {
      id: 9,
      title: 'Gestión de las emociones en el entorno laboral',
      excerpt: 'Herramientas prácticas para manejar el estrés, la frustración y otras emociones desafiantes en el ambiente de trabajo.',
      category: 'Laboral',
      categoryColor: 'bg-gray-500',
      image: '/img/blog/article3.jpg',
      date: '22 Mayo, 2023',
      readTime: '5 min lectura',
      author: 'Dra. Claudia Ramírez',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/gestion-emociones-trabajo',
      dateISO: '2023-05-22'
    },
    {
      id: 10,
      title: 'Cómo el estrés crónico afecta a tu cuerpo y mente',
      excerpt: 'Descubre los efectos del estrés prolongado en la salud física y mental, y estrategias efectivas para manejarlo antes de que cause daños.',
      category: 'Bienestar',
      categoryColor: 'bg-purple-500',
      image: '/img/blog/article1.jpg',
      date: '18 Mayo, 2023',
      readTime: '7 min lectura',
      author: 'Dr. Pablo Torres',
      authorImage: '/img/team/psychologist1.jpg',
      slug: '/blog/estres-cronico-cuerpo-mente',
      dateISO: '2023-05-18'
    },
    {
      id: 11,
      title: 'Cómo reconocer y superar la depresión funcional',
      excerpt: 'Guía para identificar la depresión que se esconde detrás de una apariencia de normalidad y funcionamiento cotidiano, con pasos para buscar ayuda.',
      category: 'Depresión',
      categoryColor: 'bg-blue-600',
      image: '/img/blog/article2.jpg',
      date: '15 Mayo, 2023',
      readTime: '6 min lectura',
      author: 'Dra. Daniela Medina',
      authorImage: '/img/team/psychologist2.jpg',
      slug: '/blog/depresion-funcional',
      dateISO: '2023-05-15'
    }
  ];
  
  // Extraer todas las categorías únicas
  const uniqueCategories = [...new Set(allArticles.map(article => article.category))];
  
  // Crear rutas para cada categoría
  return uniqueCategories.map(category => {
    const categorySlug = category.toLowerCase().replace(/\s+/g, '-');
    const articlesInCategory = allArticles.filter(article => 
      article.category.toLowerCase() === category.toLowerCase()
    );
    
    return {
      params: { categoria: categorySlug },
      props: { 
        category, 
        articles: articlesInCategory,
        categoryColor: articlesInCategory[0]?.categoryColor || 'bg-blue-500',
        allCategories: uniqueCategories
      }
    };
  });
}

// Props de la página
const { category, articles, categoryColor, allCategories } = Astro.props;

// Metadatos para SEO
const title = `${category} | Artículos sobre ${category} | MenteSana`;
const description = `Encuentra información, consejos y recursos sobre ${category}. Artículos de calidad escritos por profesionales en salud mental.`;
const keywords = `${category}, salud mental, psicología, ${category.toLowerCase()}, artículos ${category.toLowerCase()}, consejos ${category.toLowerCase()}`;
const image = articles[0]?.image || "/img/blog/blog-header.jpg";

// Schema.org data
const schemaData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "headline": `Artículos sobre ${category} - MenteSana`,
  "description": description,
  "url": Astro.url.href,
  "image": new URL(image, Astro.site || Astro.url.href).toString(),
  "publisher": {
    "@type": "Organization",
    "name": "MenteSana - Centro de Psicología",
    "logo": {
      "@type": "ImageObject",
      "url": new URL("/img/logo.svg", Astro.site || Astro.url.href).toString()
    }
  },
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": articles.map((article, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "url": new URL(article.slug, Astro.site || Astro.url.href).toString(),
      "item": {
        "@type": "BlogPosting",
        "headline": article.title,
        "description": article.excerpt,
        "image": new URL(article.image, Astro.site || Astro.url.href).toString(),
        "datePublished": article.dateISO || new Date(article.date).toISOString(),
        "author": {
          "@type": "Person",
          "name": article.author
        },
        "publisher": {
          "@type": "Organization",
          "name": "MenteSana - Centro de Psicología",
          "logo": {
            "@type": "ImageObject",
            "url": new URL("/img/logo.svg", Astro.site || Astro.url.href).toString()
          }
        },
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": new URL(article.slug, Astro.site || Astro.url.href).toString()
        }
      }
    }))
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Inicio",
        "item": new URL("/", Astro.site || Astro.url.origin).toString()
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Blog",
        "item": new URL("/blog", Astro.site || Astro.url.origin).toString()
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": category,
        "item": Astro.url.href
      }
    ]
  }
};
---

<Layout 
  title={title}
  description={description}
  keywords={keywords}
  image={image}
  canonicalURL={Astro.url.href}
>
  <Header />
  <main id="main-content">
    <Container>
      <section class="py-12 sm:py-16 mt-20">
        <div class="text-center mb-12">
          <div class={`inline-block ${categoryColor} text-white text-sm font-semibold px-4 py-2 rounded-full mb-4`}>
            Categoría: {category}
          </div>
          <h1 class="text-4xl sm:text-5xl font-bold text-gray-100 mb-4">Artículos sobre {category}</h1>
          <p class="text-base sm:text-lg text-gray-400 max-w-2xl mx-auto">
            Explora nuestra colección de recursos y consejos especializados sobre {category.toLowerCase()}.
          </p>
        </div>
        
        <!-- Filtros de categorías accesibles -->
        <div class="flex flex-wrap justify-center gap-3 mb-12" role="tablist" aria-label="Filtrar artículos por categoría">
          <a href="/blog" class="bg-dark-300/50 text-gray-300 hover:bg-primary-500/20 px-4 py-2 rounded-full text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500" role="tab">Todos</a>
          {allCategories.map(cat => (
            <a 
              href={`/blog/categoria/${cat.toLowerCase().replace(/\s+/g, '-')}`} 
              class={`${cat === category ? categoryColor + ' text-white' : 'bg-dark-300/50 text-gray-300 hover:bg-primary-500/20'} px-4 py-2 rounded-full text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500`} 
              role="tab"
              aria-selected={cat === category ? 'true' : 'false'}
            >
              {cat}
            </a>
          ))}
        </div>
        
        <!-- Grid de artículos -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
          {articles.length > 0 ? (
            articles.map(article => (
              <article class="bg-dark-300/30 rounded-xl overflow-hidden shadow-lg border border-dark-200/30 hover:border-primary-500/30 transition-all duration-300 group h-full flex flex-col">
                <a href={article.slug} class="relative overflow-hidden block">
                  <div class="relative aspect-video">
                    <LazyImage 
                      src={article.image} 
                      alt={`Imagen ilustrativa del artículo: ${article.title}`} 
                      class="w-full h-full transition-transform duration-500 group-hover:scale-105"
                      width={600}
                      height={400}
                      loading="lazy"
                      fetchpriority="low"
                    />
                    <div class="absolute inset-0 bg-gradient-to-t from-gray-900 to-transparent opacity-60"></div>
                    <div class="absolute bottom-0 left-0 p-4">
                      <span class={`${article.categoryColor} text-white text-xs font-semibold px-3 py-1 rounded-full`}>{article.category}</span>
                    </div>
                  </div>
                </a>
                
                <div class="p-6 flex-grow">
                  <div class="flex items-center text-gray-400 text-sm mb-2">
                    <time datetime={article.dateISO || new Date(article.date).toISOString().split('T')[0]} class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 inline" aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                      {article.date}
                    </time>
                    <span class="mx-2" aria-hidden="true">·</span>
                    <span class="flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 inline" aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      {article.readTime}
                    </span>
                  </div>
                  
                  <h2 class="text-xl font-semibold text-gray-100 mb-3 group-hover:text-primary-400 transition-colors">
                    <a href={article.slug} class="hover:text-primary-400 transition-colors">
                      {article.title}
                    </a>
                  </h2>
                  
                  <p class="text-gray-400 mb-4">{article.excerpt}</p>
                  
                  <div class="flex items-center">
                    <LazyImage 
                      src={article.authorImage} 
                      alt={article.author} 
                      class="w-8 h-8 rounded-full object-cover mr-3"
                      width={40}
                      height={40}
                    />
                    <span class="text-sm text-gray-300">{article.author}</span>
                  </div>
                </div>
                
                <div class="px-6 pb-6 mt-auto">
                  <ButtonSub to={article.slug} hasIcon={true} iconName="ArrowRight">
                    Leer más
                  </ButtonSub>
                </div>
              </article>
            ))
          ) : (
            <div class="col-span-full text-center py-12">
              <p class="text-gray-400 text-lg mb-4">No se encontraron artículos en esta categoría.</p>
              <ButtonSub to="/blog">
                Ver todos los artículos
              </ButtonSub>
            </div>
          )}
        </div>
        
        <!-- Breadcrumbs for better SEO and Navigation -->
        <nav aria-label="Breadcrumbs" class="mt-10 mb-8 text-sm text-gray-400">
          <ol class="flex flex-wrap items-center gap-2">
            <li>
              <a href="/" class="hover:text-primary-400 transition-colors">Inicio</a>
            </li>
            <li aria-hidden="true" class="select-none">/</li>
            <li>
              <a href="/blog" class="hover:text-primary-400 transition-colors">Blog</a>
            </li>
            <li aria-hidden="true" class="select-none">/</li>
            <li>
              <span class="text-gray-300" aria-current="page">{category}</span>
            </li>
          </ol>
        </nav>
      </section>
    </Container>
  </main>
  <Footer />
</Layout>

<!-- Schema.org markup for SEO -->
<script type="application/ld+json" set:html={JSON.stringify(schemaData)}>
</script>

<style>
  /* Estilos optimizados para mejor rendimiento */
  @media (prefers-reduced-motion: reduce) {
    img {
      transition: none;
    }
  }
</style> 