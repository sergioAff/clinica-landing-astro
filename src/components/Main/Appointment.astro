---
// Componente para solicitar citas
import ButtonMain from "../ButtonMain.astro";
---

<section id="appointment" class="w-full max-w-6xl mx-auto px-4 py-16 scroll-mt-24">
  <div class="text-center mb-12">
    <p class="text-blue-400 font-semibold tracking-widest text-sm mb-2 uppercase">Agenda tu cita</p>
    <h2 class="text-4xl font-bold text-gray-100 mb-4">Solicita una consulta</h2>
    <p class="text-lg text-gray-400 max-w-2xl mx-auto">Reserva tu primera sesión y da el primer paso hacia tu bienestar emocional.</p>
  </div>

  <div class="bg-gray-800/30 rounded-xl p-8 shadow-lg border border-gray-700/50">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      <div>
        <h3 class="text-2xl font-semibold text-gray-100 mb-6">Solicita tu cita ahora</h3>
        
        <form id="appointment-form" class="space-y-6">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div>
              <label for="name" class="block text-sm font-medium text-gray-400 mb-2">Nombre</label>
              <input 
                type="text" 
                id="name" 
                name="name" 
                required 
                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                placeholder="Tu nombre"
              />
            </div>
            
            <div>
              <label for="lastname" class="block text-sm font-medium text-gray-400 mb-2">Apellidos</label>
              <input 
                type="text" 
                id="lastname" 
                name="lastname" 
                required 
                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                placeholder="Tus apellidos"
              />
            </div>
          </div>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div>
              <label for="email" class="block text-sm font-medium text-gray-400 mb-2">Email</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                required 
                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                placeholder="Tu email"
              />
            </div>
            
            <div>
              <label for="phone" class="block text-sm font-medium text-gray-400 mb-2">Teléfono</label>
              <input 
                type="tel" 
                id="phone" 
                name="phone" 
                required
                class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                placeholder="Tu teléfono"
              />
            </div>
          </div>
          
          <div>
            <label for="service" class="block text-sm font-medium text-gray-400 mb-2">Servicio que necesitas</label>
            <select 
              id="service" 
              name="service" 
              required 
              class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
            >
              <option value="" disabled selected>Selecciona un servicio</option>
              <option value="individual">Terapia individual</option>
              <option value="couple">Terapia de pareja</option>
              <option value="child">Terapia infantil</option>
              <option value="evaluation">Evaluación psicológica</option>
              <option value="mindfulness">Mindfulness y meditación</option>
              <option value="group">Talleres grupales</option>
            </select>
          </div>
          
          <div>
            <label for="preferred_date" class="block text-sm font-medium text-gray-400 mb-2">Fecha preferida</label>
            <input 
              type="date" 
              id="preferred_date" 
              name="preferred_date" 
              required 
              class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
            />
          </div>
          
          <div>
            <label for="preferred_time" class="block text-sm font-medium text-gray-400 mb-2">Horario preferido</label>
            <select 
              id="preferred_time" 
              name="preferred_time" 
              required 
              class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
            >
              <option value="" disabled selected>Selecciona un horario</option>
              <option value="morning">Mañana (9:00 - 13:00)</option>
              <option value="afternoon">Tarde (15:00 - 20:00)</option>
              <option value="any">Cualquier horario</option>
            </select>
          </div>
          
          <div>
            <label for="comments" class="block text-sm font-medium text-gray-400 mb-2">Comentarios adicionales</label>
            <textarea 
              id="comments" 
              name="comments" 
              rows="3" 
              class="w-full bg-gray-900/50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
              placeholder="Información adicional que consideres relevante"
            ></textarea>
          </div>
          
          <div>
            <ButtonMain to="/cita" id="appointment-submit">Solicitar cita</ButtonMain>
          </div>
        </form>
      </div>
      
      <div class="space-y-8">
        <div>
          <h3 class="text-2xl font-semibold text-gray-100 mb-6">Información importante</h3>
          
          <div class="space-y-4">
            <div class="bg-gray-900/20 rounded-lg p-4 border border-gray-700/50">
              <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div>
                  <h4 class="text-lg font-medium text-gray-100">Primera consulta</h4>
                  <p class="text-gray-400 mt-1">La primera sesión tiene una duración aproximada de 60-90 minutos para realizar una evaluación inicial completa.</p>
                </div>
              </div>
            </div>
            
            <div class="bg-gray-900/20 rounded-lg p-4 border border-gray-700/50">
              <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div>
                  <h4 class="text-lg font-medium text-gray-100">Tarifas</h4>
                  <p class="text-gray-400 mt-1">Primera sesión: 80€<br>Sesiones regulares: 70€<br>Terapia de pareja: 90€<br>Terapia infantil: 75€</p>
                </div>
              </div>
            </div>
            
            <div class="bg-gray-900/20 rounded-lg p-4 border border-gray-700/50">
              <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div>
                  <h4 class="text-lg font-medium text-gray-100">Confirmación</h4>
                  <p class="text-gray-400 mt-1">Recibirás un email y/o SMS de confirmación una vez que hayamos recibido tu solicitud. Te contactaremos para confirmar la fecha y hora definitivas.</p>
                </div>
              </div>
            </div>
            
            <div class="bg-gray-900/20 rounded-lg p-4 border border-gray-700/50">
              <div class="flex items-start">
                <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
                <div>
                  <h4 class="text-lg font-medium text-gray-100">Privacidad</h4>
                  <p class="text-gray-400 mt-1">Toda la información proporcionada es confidencial y será tratada de acuerdo con nuestra política de privacidad y la legislación vigente.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Función para validar el formulario
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('appointment-form') as HTMLFormElement;
    const feedback = document.getElementById('form-feedback');
    const submitButton = document.getElementById('appointment-submit') as HTMLButtonElement;
    
    if (form && feedback && submitButton) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Cambiar estado del botón
        submitButton.disabled = true;
        submitButton.innerHTML = 'Enviando...';
        
        // Mostrar mensaje de carga
        feedback.classList.remove('hidden', 'text-red-500', 'text-green-500');
        feedback.classList.add('text-blue-400');
        feedback.textContent = 'Enviando tu solicitud...';
        
        try {
          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());
          
          // Simulación de envío (esto se reemplazaría por una llamada real a la API)
          await new Promise(resolve => setTimeout(resolve, 1500));
          
          // Aquí iría la llamada a la API real:
          // const response = await fetch('/api/submit-appointment', {
          //   method: 'POST',
          //   headers: { 'Content-Type': 'application/json' },
          //   body: JSON.stringify(data)
          // });
          
          // if (!response.ok) throw new Error('Error al enviar el formulario');
          
          // Simulación de respuesta exitosa
          feedback.classList.remove('text-blue-400', 'text-red-500');
          feedback.classList.add('text-green-500');
          feedback.textContent = '¡Solicitud enviada correctamente! Nos pondremos en contacto contigo pronto.';
          
          // Resetear formulario
          form.reset();
          
          // Guardar en localStorage que el usuario ha enviado el formulario
          localStorage.setItem('appointmentSubmitted', 'true');
          
        } catch (error) {
          // Mostrar mensaje de error
          feedback.classList.remove('text-blue-400', 'text-green-500');
          feedback.classList.add('text-red-500');
          feedback.textContent = 'Hubo un error al enviar tu solicitud. Por favor, inténtalo de nuevo o contáctanos directamente.';
          console.error('Error:', error);
        } finally {
          // Restaurar estado del botón
          submitButton.disabled = false;
          submitButton.innerHTML = 'Solicitar cita';
        }
      });
    }
  });
</script> 