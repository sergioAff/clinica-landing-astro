---
interface Props {
	title?: string;
	description?: string;
	image?: string;
	canonicalURL?: string;
	keywords?: string;
	author?: string;
	publishedTime?: string;
	modifiedTime?: string;
	language?: string;
	alternateLanguages?: {code: string, url: string}[];
}

const { 
	title = "MenteSana | Centro de Psicología Especializada",
	description = "Somos un equipo especializados y comprometidos con tu salud mental. Ofrecemos terapias personalizadas en un entorno seguro y confidencial.",
	image = "/img/social-image.svg",
	canonicalURL = Astro.url.href,
	keywords = "psicología, salud mental, terapia, psicólogos, bienestar emocional, terapia individual, terapia de pareja, ansiedad, depresión, estrés, psicoterapia, psicólogo online, terapia familiar, terapia cognitivo-conductual, mindfulness",
	author = "MenteSana",
	publishedTime,
	modifiedTime,
	language = "es",
	alternateLanguages = []
} = Astro.props;

// Solo importamos las fuentes que realmente necesitamos
import '@fontsource/inter/300.css';
import '@fontsource/inter/400.css';
import '@fontsource/inter/500.css';
import '@fontsource/inter/700.css';
import '@fontsource/montserrat/600.css';
import '@fontsource/montserrat/700.css';
import '@fontsource/montserrat/800.css';
import '../styles/global.css';
import '../styles/reset-cursor.css';
import ScrollObserver from '../components/ScrollObserver.astro';
import ChatBot from '../components/react/ChatBot';

// Obtener la URL completa para imágenes
const fullImageUrl = new URL(image, Astro.site || canonicalURL).toString();

// Metadata para la página actual
const currentPage = Astro.url.pathname;
const isHomePage = currentPage === "/";
---

<!doctype html>
<html lang={language} class="dark scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Compression directive for text compression support -->
		<meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		
		<!-- Preconexiones para recursos críticos -->
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
		<link rel="preconnect" href="https://media.cssninja.io" crossorigin />
		
		<!-- Precargar recursos críticos -->
		{isHomePage && (
			<>
				<link rel="preload" as="image" href="/img/favicon.svg" fetchpriority="high" />
				<link rel="preload" as="image" href="/img/illustrations/hero.svg" fetchpriority="high" />
				<link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
				<link rel="dns-prefetch" href="https://media.cssninja.io" />
			</>
		)}
		
		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="keywords" content={keywords} />
		<meta name="author" content={author} />
		<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
		
		<!-- Canonical URL -->
		<link rel="canonical" href={canonicalURL} />
		
		<!-- Alternate languages -->
		{alternateLanguages.map(lang => (
			<link rel="alternate" hreflang={lang.code} href={lang.url} />
		))}
		<link rel="alternate" hreflang="x-default" href={Astro.site || canonicalURL} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content={isHomePage ? "website" : "article"} />
		<meta property="og:url" content={canonicalURL} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={fullImageUrl} />
		<meta property="og:image:width" content="1200" />
		<meta property="og:image:height" content="630" />
		<meta property="og:locale" content={language === "es" ? "es_ES" : language} />
		<meta property="og:site_name" content="MenteSana" />
		{publishedTime && <meta property="article:published_time" content={publishedTime} />}
		{modifiedTime && <meta property="article:modified_time" content={modifiedTime} />}
		
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={canonicalURL} />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={fullImageUrl} />
		<meta name="twitter:site" content="@mentesana" />
		<meta name="twitter:creator" content="@mentesana" />
		
		<!-- Apple Touch Icon -->
		<link rel="apple-touch-icon" href="/img/apple-touch-icon.svg" />
		<meta name="msapplication-TileColor" content="#0f172a" />
		<meta name="theme-color" content="#0f172a" />
		
		<!-- Web App Manifest -->
		<link rel="manifest" href="/site.webmanifest" />
		
		<!-- Schema.org para servicios psicológicos -->
		<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "MedicalClinic",
			"@id": "https://mentesana.com",
			"name": "MenteSana - Centro de Psicología",
			"url": "https://mentesana.com",
			"logo": {
				"@type": "ImageObject",
				"url": "https://mentesana.com/img/logo.svg",
				"width": "180",
				"height": "60"
			},
			"image": ${JSON.stringify(fullImageUrl)},
			"telephone": "+34123456789",
			"email": "info@mentesana.com",
			"priceRange": "€€",
			"paymentAccepted": ["Tarjeta de crédito", "Efectivo", "Transferencia bancaria"],
			"currenciesAccepted": "EUR",
			"medicalSpecialty": [
				"Psicología",
				"Psicoterapia",
				"Salud mental"
			],
			"availableService": [
				{
					"@type": "MedicalTherapy",
					"name": "Terapia Individual",
					"description": "Sesiones personalizadas para tratar problemas específicos como ansiedad, depresión y estrés."
				},
				{
					"@type": "MedicalTherapy",
					"name": "Terapia de Pareja",
					"description": "Mejora de la comunicación y resolución de conflictos en la relación de pareja."
				},
				{
					"@type": "MedicalTherapy",
					"name": "Psicología Infantil",
					"description": "Apoyo especializado para niños y adolescentes con desafíos emocionales."
				},
				{
					"@type": "MedicalTherapy",
					"name": "Evaluación Psicológica",
					"description": "Evaluaciones completas para identificar patrones cognitivos y emocionales."
				}
			],
			"address": {
				"@type": "PostalAddress",
				"streetAddress": "Calle Principal, 123",
				"addressLocality": "Madrid",
				"postalCode": "28001",
				"addressCountry": "ES"
			},
			"geo": {
				"@type": "GeoCoordinates",
				"latitude": 40.416775,
				"longitude": -3.703790
			},
			"openingHoursSpecification": [
				{
					"@type": "OpeningHoursSpecification",
					"dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
					"opens": "09:00",
					"closes": "20:00"
				}
			],
			"sameAs": [
				"https://facebook.com/mentesana",
				"https://twitter.com/mentesana",
				"https://instagram.com/mentesana"
			]
		}
		</script>
		<!-- Schema.org para profesionales -->
		<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "PsychologicalTreatment",
			"name": "Servicios de Psicología en MenteSana",
			"treatmentIndication": [
				"Ansiedad",
				"Depresión",
				"Estrés",
				"Problemas de pareja",
				"Trastornos de la conducta alimentaria",
				"Fobias",
				"Trauma"
			],
			"recognizingAuthority": "Colegio Oficial de Psicólogos de Madrid",
			"relevantSpecialty": {
				"@type": "MedicalSpecialty",
				"name": "Psicología Clínica"
			},
			"status": "ActiveNotRecruiting",
			"study": {
				"@type": "MedicalStudy",
				"studyLocation": {
					"@type": "Place",
					"name": "MenteSana Centro de Psicología",
					"address": {
						"@type": "PostalAddress",
						"streetAddress": "Calle Principal, 123",
						"addressLocality": "Madrid",
						"postalCode": "28001",
						"addressCountry": "ES"
					}
				}
			}
		}
		</script>
		<!-- Schema.org para preguntas frecuentes en la página principal -->
		{isHomePage && (
			<script type="application/ld+json" async>
				{
					"@context": "https://schema.org",
					"@type": "FAQPage",
					"mainEntity": [
						{
							"@type": "Question",
							"name": "¿Cuánto tiempo dura una terapia psicológica?",
							"acceptedAnswer": {
								"@type": "Answer",
								"text": "La duración de la terapia depende de cada caso particular. Algunas personas pueden notar mejorías en pocas sesiones, mientras que otras pueden requerir un tratamiento más prolongado. En la primera consulta evaluaremos tu caso y te proporcionaremos una estimación del tiempo de tratamiento."
							}
						},
						{
							"@type": "Question",
							"name": "¿Las sesiones son presenciales u online?",
							"acceptedAnswer": {
								"@type": "Answer",
								"text": "Ofrecemos ambas modalidades. Puedes elegir entre sesiones presenciales en nuestra clínica o sesiones online a través de videollamada, según tu preferencia y disponibilidad."
							}
						},
						{
							"@type": "Question",
							"name": "¿Cómo puedo saber si necesito terapia psicológica?",
							"acceptedAnswer": {
								"@type": "Answer",
								"text": "Si experimentas malestar emocional persistente, cambios significativos en tu estado de ánimo, dificultades en tus relaciones personales o problemas para afrontar situaciones cotidianas, podría ser beneficioso consultar con un profesional. Ofrecemos una primera sesión de evaluación para ayudarte a determinar si la terapia es adecuada para ti."
							}
						},
						{
							"@type": "Question",
							"name": "¿Trabajáis con seguros médicos?",
							"acceptedAnswer": {
								"@type": "Answer",
								"text": "Sí, colaboramos con las principales compañías aseguradoras. Puedes consultar si tu seguro está entre nuestros colaboradores contactando con nosotros."
							}
						}
					]
				}
			</script>
		)}
		
		<!-- Breadcrumb for SEO -->
		{!isHomePage && (
			<script type="application/ld+json" async>
				{
					"@context": "https://schema.org",
					"@type": "BreadcrumbList",
					"itemListElement": [
						{
							"@type": "ListItem",
							"position": 1,
							"name": "Inicio",
							"item": "https://mentesana.com"
						},
						{
							"@type": "ListItem",
							"position": 2,
							"name": ${JSON.stringify(title)},
							"item": ${JSON.stringify(canonicalURL)}
						}
					]
				}
			</script>
		)}
	</head>
	<body class="min-h-screen flex flex-col bg-gradient-to-b from-slate-950 to-slate-900 selection:bg-blue-500/30 selection:text-white">
		<a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-slate-800 focus:text-white focus:rounded-md">Saltar al contenido principal</a>
		<slot />
		<ScrollObserver />
		<ChatBot client:idle />
	</body>
</html>
